# 勤務表作成アプリ (Shift Work App)

これは、介護施設や病院など、24時間365日の複雑な人員配置（デマンド）が要求される環境向けの、AI支援型シフト勤務表作成Webアプリケーションです。

ローカルのブラウザ（IndexedDB）のみで動作するスタンドアロンアプリでありながら、`react-virtuoso` による大規模テーブルの仮想化、`table-layout: fixed` によるCLS 0 の達成、およびGemini API との連携による高度な自動化機能の実現に焦点を当てています。

## 📸 スクリーンショット

### スタッフビュー

スタッフ個人の勤務と公休数を一覧で管理します。

### 勤務枠ビュー

ユニットごとの24時間デマンド（必要人数）に対し、配置されたスタッフ（実績）をガントチャートで視覚化します。

### 詳細タイムライン

セルをクリックすると、その日の詳細なタイムライン（0.5人シェアや夜勤の状況）を確認できます。

---

## ✨ 主な機能

- **データ管理:**

  - **スタッフ:** 常勤・パート・応援（Rental）の種別、勤務可能なパターンを管理します。

  - **ユニット:** 24時間（1時間単位）のデマンド（例: `0.5`人、`2.0`人）を設定できます。

  - **勤務パターン:** 日勤、夜勤（日またぎ）、シェア可能（`crossUnitWorkType`） などの詳細なパターンを定義できます。

- **AIサポート:**

  - **AIで草案を作成:** 全ての制約とデマンドを考慮し、勤務表の草案をゼロから生成します。

  - **公休数強制補正:** 現在の配置を可能な限り維持しつつ、公休数の過不足のみをAIが\*\*差分（パッチ）\*\*で修正します。

  - **AI現況分析:** 現在の設定で物理的に配置が不可能（例: 人員不足）でないか診断します。

- **ロジックによる穴埋め:**

  - 「応援スタッフで埋める」機能により、AIを使わずに不足ギャップ（夜勤や0.5人シェア含む）を自動配置します。

  - 配置時は、月間の総アサイン時間に基づき、特定のスタッフに負荷が偏らないよう**負荷分散**を行います。

---

## 🛠️ 技術スタック

- **フロントエンド:** React 19, TypeScript

- **ビルドツール:** Vite

- **状態管理:** Redux Toolkit

- **UI:** Material-UI (MUI)

- **仮想化:** `react-virtuoso`

- **クライアントDB:** Dexie.js (IndexedDB)

- **AI:** Google Gemini API

---

## 🚀 実行方法

1. **依存関係のインストール:**

    ```bash
    npm install
    ```

2. **開発サーバーの起動:**

    ```bash
    npm run dev
    ```

3. **APIキーの設定:**

    - アプリケーション（`http://localhost:5173`）を開き、右上の設定（⚙️）アイコンから「設定」ページ（`/settings`）に移動します。

    - お持ちの Google Gemini API キーを入力し、「接続テスト & モデル読込」を実行してください。

    - モデル（例: `gemini-1.5-pro`）を選択し、「設定を保存」してください。

    - これで「AIサポート」機能 が利用可能になります。
